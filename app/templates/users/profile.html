{% extends "base.html" %}

{% block title %}{{ user.username }} - プロフィール{% endblock %}

{% block content %}
<div class="profile-container">
    <div class="profile-header">
        <div class="profile-avatar">{{ user.username[0] }}</div>
        <div class="profile-info">
            <h1>{{ user.username }}</h1>
            {% if user.about_me %}
            <p class="profile-bio">{{ user.about_me }}</p>
            {% endif %}
            <p class="profile-meta">登録日: {{ user.created_at.strftime('%Y年%m月%d日') }}</p>
            
            {% if user != current_user and current_user.is_authenticated %}
            <div class="profile-actions">
                {% if current_user.is_following(user) %}
                <a href="{{ url_for('users.unfollow', username=user.username) }}" class="btn btn-secondary">フォロー解除</a>
                {% else %}
                <a href="{{ url_for('users.follow', username=user.username) }}" class="btn btn-primary">フォローする</a>
                {% endif %}
            </div>
            {% elif user == current_user %}
            <div class="profile-actions">
                <a href="{{ url_for('users.edit_profile') }}" class="btn btn-secondary">プロフィール編集</a>
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="profile-stats">
        <div class="stat-card">
            <div class="stat-value">{{ user.books|length }}</div>
            <div class="stat-label">登録書籍</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ user.followed.count() }}</div>
            <div class="stat-label">フォロー中</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ user.followers.count() }}</div>
            <div class="stat-label">フォロワー</div>
        </div>
    </div>
    
    {% if can_view %}
    <div class="profile-books">
        <div class="section-header">
            <h2>最近追加した本</h2>
            <a href="{{ url_for('users.bookshelf', username=user.username) }}" class="view-all">すべて見る</a>
        </div>
        
        {% if user.books %}
        <div class="book-grid">
            {% for book in user.books[:6] %}
            <div class="book-card">
                <a href="{{ url_for('books.book_detail', book_id=book.id) }}">
                    <div class="book-cover">
                        {% if book.thumbnail %}
                        <img src="{{ book.thumbnail }}" alt="{{ book.title }}">
                        {% else %}
                        <div class="no-cover">表紙なし</div>
                        {% endif %}
                    </div>
                    <div class="book-info">
                        <h3 class="book-title">{{ book.title }}</h3>
                        <p class="book-authors">{{ book.authors }}</p>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="no-books">まだ本が登録されていません。</p>
        {% endif %}
    </div>
    {% else %}
    <div class="private-profile">
        <p>このユーザーのプロフィールは非公開に設定されています。</p>
    </div>
    {% endif %}
</div>
{% endblock %} 